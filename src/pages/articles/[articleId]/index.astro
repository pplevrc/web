---
import PageHeading from "@components/decoratives/Headings/PageHeading.astro";
import ArticleContentSection from "@components/pages/articles/ArticleContentSection/ArticleContentSection.astro";
import ArticleNavigation from "@components/pages/articles/ArticleNavigation/ArticleNavigation.astro";
import Layout from "@layouts/Layout.astro";
import { fetchArticleById, fetchArticleIds } from "@lib/contents/articles";
import { fetchPageThumbnailImage } from "@lib/contents/assets";
import { css } from "@styles/css";

export async function getStaticPaths() {
  const articleIds = await fetchArticleIds();

  return articleIds.map((articleId) => ({
    params: { articleId },
  }));
}

const { articleId } = Astro.params;

const article = await fetchArticleById(articleId);

const headerImage = await fetchPageThumbnailImage("article");

const title = article.title;

const description = article.description;

const keywords = article.keywords;

const mainClass = css({
  display: "flex",
  flexDir: "column",
  alignItems: "center",
});

const contentClass = css({
  paddingTop: "26",
  paddingBottom: "42",
});

// 末尾の Query Parameter を削除した src 文字列 (thumbnail.src は debug mode では URL ではない)
const ogp = headerImage.src.split("?")[0];
---

<Layout
  headMeta={{
    title: `${title} | お知らせ | ロリっ子喫茶ぷぷりえ`,
    description,
    keywords,
    ogp,
  }}
  themeColor={article.themeColor}
  mainClass={mainClass}
  defineShapes={["star"]}
>
  <PageHeading img={headerImage}>お知らせ</PageHeading>
  <ArticleContentSection
    contentHtml={article.content}
    thumbnail={article.thumbnail}
    thumbnailAlt={article.thumbnailAlt}
    thumbnailDisplayAlt={article.thumbnailDisplayAlt}
    title={title}
    themeColor={article.themeColor}
    publishedAt={article.publishedAt}
    class={contentClass}
  />
  <ArticleNavigation />
</Layout>
