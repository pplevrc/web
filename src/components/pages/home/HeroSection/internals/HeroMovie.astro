---
import ResponsiveVideo, {
  type Sources,
} from "@components/commons/ResponsiveVideo/ResponsiveVideo.astro";

// for production mode
// VP9 対応ブラウザがすでに大半浸透しているため, これをサポートの下限にする
// @ts-ignore ファイルが動的に作られるため
import movieProdPcAv1 from "@assets/videos/top-pc.generated.av1.webm";
// @ts-ignore ファイルが動的に作られるため
import movieProdPcVp9 from "@assets/videos/top-pc.generated.vp9.webm";
// @ts-ignore ファイルが動的に作られるため
import movieProdSpAv1 from "@assets/videos/top-sp.generated.av1.webm";
// @ts-ignore ファイルが動的に作られるため
import movieProdSpVp9 from "@assets/videos/top-sp.generated.vp9.webm";

// for development mode
// 開発向けにはエンコードが最も早い H264 のみを表示する
// @ts-ignore ファイルが動的に作られるため
import movieDevPcH264 from "@assets/videos/top-pc.generated.dev.h264.mp4";
// @ts-ignore ファイルが動的に作られるため
import movieDevSpH264 from "@assets/videos/top-sp.generated.dev.h264.mp4";

// for poster image
// @ts-ignore ファイルが動的に作られるため
import thumbnail from "@assets/videos/top.generated.thumbnail.webp"

const props = Astro.props;

const isDev = process.env["NODE_ENV"] !== "production";

const devSources: Sources[] = [{ pc: movieDevPcH264, sp: movieDevSpH264 }];

const prodSources: Sources[] = [
  { pc: movieProdPcAv1, sp: movieProdSpAv1 },
  { pc: movieProdPcVp9, sp: movieProdSpVp9 },
];

const sources = isDev ? devSources : prodSources;
---

<ResponsiveVideo
  muted
  autoplay
  playsinline
  disableRemotePlayback
  loop
  aria-label="ロリっ子喫茶ぷぷりえの紹介ムービー"
  preload="metadata"
  poster={thumbnail.src}
  sources={sources}
  {...props}
/>