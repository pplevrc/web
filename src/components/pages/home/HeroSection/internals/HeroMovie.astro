---
import ResponsiveVideo, {
  type Sources,
} from "@components/commons/ResponsiveVideo/ResponsiveVideo.astro";

// for production mode
// VP9 対応ブラウザがすでに大半浸透しているため, これをサポートの下限にする
import movieProdPcAv1 from "@assets/videos/top-pc.generated.av1.webm";
import movieProdPcVp9 from "@assets/videos/top-pc.generated.vp9.webm";
import movieProdSpAv1 from "@assets/videos/top-sp.generated.av1.webm";
import movieProdSpVp9 from "@assets/videos/top-sp.generated.vp9.webm";

// for development mode
// 開発向けにはエンコードが最も早い H264 のみを表示する
import movieDevPcH264 from "@assets/videos/top-pc.generated.dev.h264.mp4";
import movieDevSpH264 from "@assets/videos/top-sp.generated.dev.h264.mp4";

// ※ poster 画像 .. 使用しない. 動画の最適化がかなりされているため, poster なしでも違和感なく表示できる
// ただ、指定しないと余計な画像が出てくるブラウザがあるので、空の画像を指定しておく

const props = Astro.props;

const isDev = process.env["NODE_ENV"] !== "production";

const devSources: Sources[] = [{ pc: movieDevPcH264, sp: movieDevSpH264 }];

const prodSources: Sources[] = [
  { pc: movieProdPcAv1, sp: movieProdSpAv1 },
  { pc: movieProdPcVp9, sp: movieProdSpVp9 },
];

const sources = isDev ? devSources : prodSources;
---

<ResponsiveVideo
  muted
  autoplay
  playsInline
  preload="auto"
  disableRemotePlayback
  loop
  aria-label="ロリっ子喫茶ぷぷりえの紹介ムービー"
  poster="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEA"
  sources={sources}
  {...props}
/>