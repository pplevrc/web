# ソース画像と切り抜きに関するドキュメント

## ソース画像

VRChat のワールド [The Avatar Studio](https://vrchat.com/home/world/wrld_96460268-8c89-438f-b8f2-2ea2f1ed1ce7/info) にて, 下記のような手順で撮影した画像がソースとなる

1. AviLight を最大に設定.
1. 撮影したいアバターが地面に接地していることを確認.
1. カメラの解像度を 4K に設定
1. 撮影用アセット `Quick image generator` に移動し, `START` ボタンを押下.
1. `Select your image style` 画面で, 4K にチェックを入れ, 右上の `Introduction image` を選択.
1. `Select your type` 画面で, `Facial Change` にチェックが入っていないことを確認した上で, `Type C` を選択.
1. `Select your pose` で好きなポーズを選択 (フルトラなら custom を推奨)
1. 選択後, 撮影が始まる. 開始直後と, だいたい 5 秒後に再度撮影される.
1. 撮影結果のプレビューにて, `Background` タブが開かれていると思うので, まず `Background` を透明に設定.
1. `Label` タブを開き, `Character Name` `Creator Name` のテキストをすべて消し, `Wartrmark` を OFF にする
1. `Effect` タブを開き, `Outline Shadow` を OFF にする
1. 確定後, `Place the camera` 範囲にカメラを設置し, ワールドで撮影されたデータをカメラで撮り直し, ローカルの画像データとして取得する.

## 構成と切り抜き

撮影された画像は以下のようなレイアウトになっている

```plaintext
+-------------------+-------------------+-------------------+
| Character Name    |                   |                   |
| Creator Name      | Blank             |                   |
+-------------------+-------------------+ Right top side    |
|                   |                   | face              |
|                   |                   |                   |
| Full Body         | Frontal face      +-------------------+
|                   |                   |                   |
|                   |                   |                   |
|                   +-------------------+ Left bottom side  |
|                   |                   | face              |
|                   | Blank             |                   |
+-------------------+-------------------+-------------------+
```

共通作業・共通規格で撮影しているため, ソース画像は, 上記のレイアウトで 4K (3840px x 2160px) の画像で統一される.

### Full Body の切り抜き

Full Body 部分（左側の領域）は以下のように切り抜かれる.

```plaintext
+-------------------+---------------------------------------+
|  ↕ 400px margin   |                                       |
|  out of crop      |                                       |
+-+-----------------+ ←           out of crop             → |
| |                 |                                       |
|1|                 |                                       |
|0|                 |                                       |
|0|   ↕ 1760px      |                                       |
|p|                 |                                       |
|x|                 |                                       |
| | ←    1300px   → |                                       |
| ←    1400px     → |                                       |
+-------------------+---------------------------------------+
```

切り抜きパラメータ：

- 元画像の左部分サイズ: 1400px × 2160px
- 左マージン: 100px
- 上マージン: 400px（キャラクター名等の表示領域を除去）
- 切り抜きサイズ: 1300px × 1760px
- アスペクト比: 約 0.739 (1300/1760)

この切り抜きにより, キャラクター名やクリエイター名が表示される上部の余白と左側の余白を除去し, アバターの全身が適切に収まる領域を確保する.

また, アバターの身長に対して等倍の画像となるよう, 以下の計算式の倍率を掛けた結果を最終的な画像サイズとする.

```math
\text{倍率} = \frac{実際のアバター身長}{基準値 (90cm)}
```

TODO: The Avatar Studio の仕様で, Full Body が横幅に広い場合, FullBody の領域に収まるように中央をアンカーとして画像が縮小される. つまり, この計算式だと一部のアバターが宙に浮く.


### Frontal face の切り抜き

