---
import {
  type SocialLinkType,
  detectType,
} from "@lib/contents/commons/SocialLink";
import AmazonWishlistLink from "./internals/AmazonWishListLink.astro";
import BlueSkyLink from "./internals/BlueSkyLink.astro";
import DiscordLink from "./internals/DiscordLink.astro";
import GitHubLink from "./internals/GitHubLink.astro";
import MastodonLink from "./internals/MastodonLink.astro";
import MisskeyLink from "./internals/MisskeyLink.astro";
import OtherLink from "./internals/OtherLink.astro";
import PixivBoothLink from "./internals/PixivBoothLink.astro";
import PixivBoothWishlistLink from "./internals/PixivBoothWishListLink.astro";
import PixivFanboxLink from "./internals/PixivFanboxLink.astro";
import PixivVroidHubLink from "./internals/PixivVroidHubLink.astro";
import SkebLink from "./internals/SkebLink.astro";
import SteamLink from "./internals/SteamLink.astro";
import VRChatLink from "./internals/VRChatLink.astro";
import XLink from "./internals/XLink.astro";
import YoutubeLink from "./internals/YoutubeLink.astro";

interface Props {
  /**
   *
   */
  type?: SocialLinkType;
  /**
   *
   */
  url: string | URL;

  /**
   *
   */
  description: string;
}

const { type, url, description } = Astro.props;

const fixedUrl = url instanceof URL ? url : new URL(url);

const fixedType = type ?? (await detectType(fixedUrl));

const componentMap = {
  youtube: YoutubeLink,
  x: XLink,
  mastodon: MastodonLink,
  misskey: MisskeyLink,
  bluesky: BlueSkyLink,
  discord: DiscordLink,
  "pixiv-fanbox": PixivFanboxLink,
  "pixiv-booth": PixivBoothLink,
  skeb: SkebLink,
  "pixiv-vroid-hub": PixivVroidHubLink,
  steam: SteamLink,
  github: GitHubLink,
  "amazon-wishlist": AmazonWishlistLink,
  "pixiv-booth-wishlist": PixivBoothWishlistLink,
  vrchat: VRChatLink,
  other: OtherLink,
  // biome-ignore lint/suspicious/noExplicitAny: 汎用的な型としての利用のため一旦許容. あと Component の正しい型がわからない
} as const satisfies Record<SocialLinkType, (props: any) => any>;

const Component = componentMap[fixedType];
---

<Component url={fixedUrl} description={description} />
