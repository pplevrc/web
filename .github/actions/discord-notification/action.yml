name: Discordé€šçŸ¥
description: ãƒ“ãƒ«ãƒ‰çµæœãªã©ã®è©³ç´°æƒ…å ±ã‚’ Discord ã«é€šçŸ¥

inputs:
  webhook_url:
    description: Discord Webhook URL
    required: true
  status:
    description: "ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼ˆè‰²é¸æŠç”¨: start, success, failureï¼‰"
    required: true
  title:
    description: é€šçŸ¥ã‚¿ã‚¤ãƒˆãƒ«
    required: true
  description:
    description: é€šçŸ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
    required: true
  username:
    description: Discordã«è¡¨ç¤ºã™ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼å
    required: false
    default: GitHub Actions

runs:
  using: 'composite'
  steps:
    # Discordé€šçŸ¥ã‚’é€ä¿¡ï¼ˆãƒ€ãƒŸãƒ¼å®Ÿè£…ï¼‰
    - name: ğŸ“¢ Discordé€šçŸ¥ã‚’é€ä¿¡
      run: |
        case "${{ inputs.status }}" in
          start)
            COLOR="3447003"  # é’è‰²
            ;;
          success)
            COLOR="3066993"  # ç·‘è‰²
            ;;
          failure)
            COLOR="15158332"  # èµ¤è‰²
            ;;
          *)
            COLOR="10181046"  # ã‚°ãƒ¬ãƒ¼è‰²
            ;;
        esac

        # Discord Webhookç”¨ã®JSONãƒšã‚¤ãƒ­ãƒ¼ãƒ‰
        PAYLOAD=$(cat <<EOF
        {
          "username": "${{ inputs.username }}",
          "embeds": [{
            "title": "${{ inputs.title }}",
            "description": "${{ inputs.description }}",
            "color": ${COLOR},
            "fields": [
              {
                "name": "ãƒªãƒã‚¸ãƒˆãƒª",
                "value": "${{ github.repository }}",
                "inline": true
              },
              {
                "name": "ãƒ–ãƒ©ãƒ³ãƒ",
                "value": "${{ github.ref_name }}",
                "inline": true
              },
              {
                "name": "ã‚³ãƒŸãƒƒãƒˆ",
                "value": "[\`${{ github.sha }}\`](${{ github.server_url }}/${{ github.repository }}/commit/${{ github.sha }})",
                "inline": true
              },
              {
                "name": "å®Ÿè¡Œè€…",
                "value": "${{ github.actor }}",
                "inline": true
              },
              {
                "name": "ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼",
                "value": "[${{ github.workflow }}](${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }})",
                "inline": true
              },
              {
                "name": "æ™‚åˆ»",
                "value": "$(date -u '+%Y-%m-%d %H:%M:%S UTC')",
                "inline": true
              }
            ]
          }]
        }
        EOF
        )

        # ç¾åœ¨ã¯ãƒ€ãƒŸãƒ¼å®Ÿè£…ï¼šå®Ÿéš›ã®webhookã¯å¾Œã§è¨­å®š
        echo "ğŸ“¢ Discordé€šçŸ¥é€ä¿¡ï¼ˆãƒ€ãƒŸãƒ¼ï¼‰:"
        echo "URL: ${{ inputs.webhook_url }}"
        echo "Status: ${{ inputs.status }}"
        echo "Title: ${{ inputs.title }}"
        echo "Description: ${{ inputs.description }}"
        echo "Color: ${COLOR}"

        # å®Ÿéš›ã®curlé€ä¿¡ã¯ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆ
        # curl -H "Content-Type: application/json" \
        #      -d "${PAYLOAD}" \
        #      "${{ inputs.webhook_url }}"
      shell: bash