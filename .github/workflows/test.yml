name: ğŸ” ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆå“è³ªãƒã‚§ãƒƒã‚¯
description: ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«å¯¾ã—ã¦ã‚³ãƒ¼ãƒ‰å“è³ªãƒã‚§ãƒƒã‚¯ï¼ˆlintã€typecheckã€buildï¼‰ã‚’å®Ÿè¡Œ

on:
  pull_request:
    branches: [main]

# åŒã˜PRã§è¤‡æ•°å›å®Ÿè¡Œã•ã‚ŒãŸå ´åˆã€å¤ã„å®Ÿè¡Œã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¦æœ€æ–°ã®ã‚‚ã®ã®ã¿ã‚’å®Ÿè¡Œ
concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

jobs:
  setup:
    name: ğŸ“¦ ä¾å­˜é–¢ä¿‚ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
    runs-on: ubuntu-latest
    environment: NO_CMS # ãƒ€ãƒŸãƒ¼ã®CMSè¨­å®šã‚’ä½¿ç”¨
    steps:
      # ãƒªãƒã‚¸ãƒˆãƒªã®ã‚³ãƒ¼ãƒ‰ã‚’ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
      - name: ğŸ“ ã‚³ãƒ¼ãƒ‰ã‚’ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
        uses: actions/checkout@v4

      # Node.js + Yarn ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ï¼ˆå…±é€šã®composite actionã‚’ä½¿ç”¨ï¼‰
      - name: ğŸ› ï¸ Node.js + Yarn ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
        uses: ./.github/actions/setup-node-yarn

  typecheck:
    name: ğŸ” å‹ãƒã‚§ãƒƒã‚¯
    runs-on: ubuntu-latest
    environment: NO_CMS # ãƒ€ãƒŸãƒ¼ã®CMSè¨­å®šã‚’ä½¿ç”¨
    needs: setup
    steps:
      # ãƒªãƒã‚¸ãƒˆãƒªã®ã‚³ãƒ¼ãƒ‰ã‚’ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
      - name: ğŸ“ ã‚³ãƒ¼ãƒ‰ã‚’ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
        uses: actions/checkout@v4

      # Node.js + Yarn ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ï¼ˆå…±é€šã®composite actionã‚’ä½¿ç”¨ï¼‰
      - name: ğŸ› ï¸ Node.js + Yarn ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
        uses: ./.github/actions/setup-node-yarn


      - name: ğŸ” PandaCSS ã§ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã‚’å®Ÿè¡Œ
        run: yarn prepare:panda

      # TypeScriptã®å‹ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œï¼ˆMOCK=trueã§CMSãªã—ã§ã‚‚å‹•ä½œï¼‰
      - name: ğŸ” TypeScriptã®å‹ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œ
        run: yarn typecheck
        env:
          MOCK: ${{ vars.MOCK }}
          SITE_DOMAIN: http://localhost
          SITE_IS_PUBLIC: false

  lint:
    name: ğŸ§¹ ã‚³ãƒ¼ãƒ‰å“è³ªãƒã‚§ãƒƒã‚¯
    runs-on: ubuntu-latest
    environment: NO_CMS # ãƒ€ãƒŸãƒ¼ã®CMSè¨­å®šã‚’ä½¿ç”¨
    needs: setup
    steps:
      # ãƒªãƒã‚¸ãƒˆãƒªã®ã‚³ãƒ¼ãƒ‰ã‚’ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
      - name: ğŸ“ ã‚³ãƒ¼ãƒ‰ã‚’ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
        uses: actions/checkout@v4

      # Node.js + Yarn ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ï¼ˆå…±é€šã®composite actionã‚’ä½¿ç”¨ï¼‰
      - name: ğŸ› ï¸ Node.js + Yarn ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
        uses: ./.github/actions/setup-node-yarn

      # Biomeã§ã‚³ãƒ¼ãƒ‰ã®å“è³ªã‚’ãƒã‚§ãƒƒã‚¯ï¼ˆlint + formatï¼‰
      - name: ğŸ§¹ Biomeã§ã‚³ãƒ¼ãƒ‰å“è³ªã‚’ãƒã‚§ãƒƒã‚¯
        run: yarn biome

  # FIXME: ãƒ†ã‚¹ãƒˆã¯ã¾ã ã†ã¾ãå‹•ã‹ãªã„ã®ã§ã€ä¸€æ—¦ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆ
  # test:
  #   name: ğŸ§ª ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
  #   runs-on: ubuntu-latest
  #   environment: NO_CMS # ãƒ€ãƒŸãƒ¼ã®CMSè¨­å®šã‚’ä½¿ç”¨
  #   needs: setup
  #   steps:
  #     # ãƒªãƒã‚¸ãƒˆãƒªã®ã‚³ãƒ¼ãƒ‰ã‚’ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
  #     - name: ğŸ“ ã‚³ãƒ¼ãƒ‰ã‚’ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
  #       uses: actions/checkout@v4

  #     # Node.js + Yarn ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ï¼ˆå…±é€šã®composite actionã‚’ä½¿ç”¨ï¼‰
  #     - name: ğŸ› ï¸ Node.js + Yarn ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
  #       uses: ./.github/actions/setup-node-yarn

  #     # Vitestã§ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œï¼ˆCIç’°å¢ƒç”¨ã®è¨­å®šï¼‰
  #     - name: ğŸ§ª Vitestã§ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
  #       run: yarn test:ci

  build:
    name: ğŸ—ï¸ ãƒ“ãƒ«ãƒ‰æ¤œè¨¼
    runs-on: ubuntu-latest
    environment: NO_CMS # ãƒ€ãƒŸãƒ¼ã®CMSè¨­å®šã‚’ä½¿ç”¨
    needs: setup
    steps:
      # ãƒªãƒã‚¸ãƒˆãƒªã®ã‚³ãƒ¼ãƒ‰ã‚’ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
      - name: ğŸ“ ã‚³ãƒ¼ãƒ‰ã‚’ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
        uses: actions/checkout@v4

      # Node.js + Yarn ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ï¼ˆå…±é€šã®composite actionã‚’ä½¿ç”¨ï¼‰
      - name: ğŸ› ï¸ Node.js + Yarn ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
        uses: ./.github/actions/setup-node-yarn

      # MOCKãƒ¢ãƒ¼ãƒ‰ã§æœ¬ç•ªãƒ“ãƒ«ãƒ‰ã‚’å®Ÿè¡Œï¼ˆCMSãªã—ã§ã‚‚ãƒ“ãƒ«ãƒ‰ãŒé€šã‚‹ã“ã¨ã‚’ç¢ºèªï¼‰
      - name: ğŸ—ï¸ æœ¬ç•ªãƒ“ãƒ«ãƒ‰ã‚’å®Ÿè¡Œ
        run: yarn build
        env:
          MOCK: ${{ vars.MOCK }}
          SITE_DOMAIN: http://localhost
          SITE_IS_PUBLIC: false
